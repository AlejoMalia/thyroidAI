/* ThyroidAI - Alejo Malia . 2026 */
/* "The software code is provided for research purposes under the spirit of the CC BY-NC 4.0 license."*/

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThyroidAI v1.2 - Smart Memory + Triangulaci√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #ffffff; color: #111827; }
        .step-content { display: none; }
        .step-content.active { display: block; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .progress-bar { transition: width 1s ease-in-out; }
        .saved-badge { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
        .med-chip { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="antialiased">

    <header class="pt-16 pb-10 flex justify-center border-b border-gray-50">
        <img src="../docs/brand.png" alt="ThyroidAI" class="h-11 object-contain" onerror="this.style.display='none'">
    </header>

    <main class="max-w-6xl mx-auto px-6 py-12 transition-all duration-500">
        
        <div id="step-1" class="step-content active text-center">
            <h2 class="text-sm font-bold uppercase tracking-widest text-gray-400 mb-8">üåç Choose Language</h2>
            <div class="grid grid-cols-2 sm:grid-cols-5 gap-3" id="lang-grid"></div>
        </div>

        <div id="step-2" class="step-content">
            <h2 id="title-step-2" class="text-2xl font-bold mb-8 text-center"></h2>
            <div class="space-y-3" id="provider-grid"></div>
            <button onclick="setStep(1)" class="w-full mt-6 text-xs font-bold text-gray-400 uppercase tracking-widest">‚Üê Back</button>
        </div>

        <div id="step-3" class="step-content">
            <h2 id="title-step-3" class="text-2xl font-bold mb-6"></h2>
            <div class="space-y-6">
                <div id="api-key-container">
                    <input type="password" id="api-key" placeholder="API Key" class="w-full border-b-2 border-gray-100 py-4 text-xl outline-none focus:border-black transition-all">
                </div>
                <div id="model-container" class="hidden">
                    <label class="block text-[10px] font-bold text-gray-400 uppercase mb-2" id="label-models"></label>
                    <select id="model-select" class="w-full border-b-2 border-gray-100 py-4 text-xl outline-none focus:border-black bg-white"></select>
                </div>
                <button id="btn-sync" class="w-full bg-black text-white py-4 rounded-full font-bold hover:bg-gray-800 transition-all uppercase tracking-widest text-sm">Sync Models</button>
                <button onclick="setStep(2)" class="w-full text-xs font-bold text-gray-400 uppercase tracking-widest">‚Üê Change Provider</button>
            </div>
        </div>

        <div id="step-4" class="step-content">
            <div class="flex justify-between items-center mb-8">
                <h2 id="title-step-4" class="text-2xl font-bold"></h2>
                <div id="ai-status-tag" class="hidden flex items-center bg-green-50 px-3 py-1 rounded-full border border-green-100">
                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2 saved-badge"></span>
                    <span class="text-[9px] font-black text-green-700 uppercase" id="saved-ai-name"></span>
                    <button onclick="clearAISettings()" class="ml-3 text-[9px] font-bold text-gray-400 hover:text-red-500 uppercase tracking-tighter">Change IA</button>
                </div>
            </div>
            <div class="space-y-8">
                <div>
                    <label class="block text-[10px] font-bold text-gray-400 uppercase mb-3" id="label-condition"></label>
                    <select id="condition-select" class="w-full border-2 border-gray-100 p-4 rounded-2xl outline-none focus:border-black font-medium"></select>
                </div>

                <!-- === NUEVO PANEL DE MEDICACI√ìN (manteniendo estilo exacto) === -->
                <div class="pt-6 border-t border-gray-100">
                    <label class="block text-[10px] font-bold text-gray-400 uppercase mb-3" id="label-meds"></label>
                    <div id="meds-list" class="space-y-3"></div>
                    <button onclick="openMedModal()" class="w-full mt-4 bg-white border-2 border-dashed border-gray-200 hover:border-black py-4 rounded-2xl text-sm font-bold flex items-center justify-center gap-2 transition-all">
                        üíä <span id="add-med-text"></span>
                    </button>
                </div>

                <div class="border-2 border-dashed border-gray-100 rounded-3xl p-12 text-center hover:border-black transition-all cursor-pointer relative">
                    <input type="file" id="pdf-file" accept=".pdf" class="absolute inset-0 opacity-0 cursor-pointer">
                    <p class="text-gray-400" id="pdf-label">Click or drop Laboratory PDF</p>
                    <p id="file-name" class="mt-2 font-bold text-black"></p>
                </div>
                <button id="btn-analyze" class="w-full bg-black text-white py-5 rounded-full font-black text-lg shadow-xl hover:scale-[1.02] transition-all uppercase tracking-tighter">Start Analysis</button>
            </div>
        </div>

        <div id="step-loading" class="step-content text-center py-20">
            <div class="inline-block w-12 h-12 border-4 border-gray-100 border-t-black rounded-full animate-spin mb-6"></div>
            <h2 id="loading-text" class="text-xl font-bold animate-pulse"></h2>
        </div>

        <div id="dashboard" class="hidden">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-12 border-b pb-8 border-gray-50">
                <div>
                    <h1 id="dash-res-title" class="text-4xl font-black uppercase tracking-tighter"></h1>
                    <p id="dash-condition" class="text-gray-400 font-bold uppercase text-xs mt-1"></p>
                </div>
                <button onclick="location.reload()" class="mt-4 md:mt-0 text-[10px] font-bold border border-gray-200 px-4 py-2 rounded-full hover:bg-gray-50 uppercase tracking-widest">New Analysis</button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                <div class="lg:col-span-1 space-y-8" id="markers-ui">
                    <h3 id="dash-markers-title" class="text-xs font-black text-gray-400 uppercase tracking-widest border-b pb-2"></h3>
                </div>
                <div class="lg:col-span-2 space-y-12">
                    <!-- Nueva secci√≥n: Impacto de Medicaci√≥n -->
                    <div id="med-impact-section">
                        <h3 id="dash-medimpact-title" class="text-xs font-black text-gray-400 uppercase tracking-widest border-b pb-4 mb-6"></h3>
                        <div id="med-impact-ui" class="text-base leading-relaxed text-gray-700 border-l-4 border-emerald-500 pl-8"></div>
                    </div>

                    <div>
                        <h3 id="dash-patterns-title" class="text-xs font-black text-gray-400 uppercase tracking-widest border-b pb-4 mb-6"></h3>
                        <div id="patterns-ui" class="flex flex-wrap gap-2"></div>
                    </div>

                    <!-- Nueva secci√≥n: Triangulaci√≥n Avanzada -->
                    <div>
                        <h3 id="dash-triang-title" class="text-xs font-black text-gray-400 uppercase tracking-widest border-b pb-4 mb-6"></h3>
                        <div id="triang-ui" class="text-base leading-relaxed text-gray-700 italic border-l-4 border-violet-500 pl-8 whitespace-pre-line"></div>
                    </div>

                    <div>
                        <h3 id="dash-report-title" class="text-xs font-black text-gray-400 uppercase tracking-widest border-b pb-4 mb-6"></h3>
                        <div id="report-ui" class="text-lg leading-relaxed text-gray-700 italic font-light border-l-4 border-black pl-8 whitespace-pre-line"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- === MODAL MEDICACI√ìN (estilo id√©ntico al resto de la app) === -->
    <div id="med-modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-[100]">
        <div class="bg-white rounded-3xl max-w-md w-full mx-4 overflow-hidden">
            <div class="px-8 pt-8 pb-6 border-b">
                <h3 id="med-modal-title" class="text-2xl font-bold"></h3>
            </div>
            <div class="p-8 space-y-6">
                <div>
                    <label class="block text-[10px] font-bold text-gray-400 uppercase mb-2">Tipo de medicaci√≥n</label>
                    <select id="med-type" class="w-full border-2 border-gray-100 p-4 rounded-2xl outline-none focus:border-black">
                        <option value="Levotiroxina (T4)">Levotiroxina (T4)</option>
                        <option value="Liotironina (T3)">Liotironina (T3)</option>
                        <option value="NDT / Armour / Nature-Throid">NDT / Armour / Nature-Throid</option>
                        <option value="Combinado T4+T3">Combinado T4+T3</option>
                        <option value="Antitiroideo">Antitiroideo (MMI / PTU)</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-gray-400 uppercase mb-2">Medicamento espec√≠fico</label>
                    <input id="med-name" type="text" placeholder="Eutirox, Synthroid, Cytomel..." class="w-full border-2 border-gray-100 p-4 rounded-2xl outline-none focus:border-black">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-2">Dosis</label>
                        <input id="med-dose" type="text" placeholder="125 mcg" class="w-full border-2 border-gray-100 p-4 rounded-2xl outline-none focus:border-black">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-2">Frecuencia</label>
                        <input id="med-freq" type="text" value="Diaria" class="w-full border-2 border-gray-100 p-4 rounded-2xl outline-none focus:border-black">
                    </div>
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-gray-400 uppercase mb-2">Fecha de inicio</label>
                    <input id="med-start" type="date" class="w-full border-2 border-gray-100 p-4 rounded-2xl outline-none focus:border-black">
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-gray-400 uppercase mb-2">Notas cl√≠nicas</label>
                    <textarea id="med-notes" rows="3" placeholder="Efectos observados, intolerancias..." class="w-full border-2 border-gray-100 p-4 rounded-2xl outline-none focus:border-black"></textarea>
                </div>
            </div>
            <div class="flex border-t">
                <button onclick="closeMedModal()" class="flex-1 py-5 text-gray-500 font-bold hover:bg-gray-50 transition-all">Cancelar</button>
                <button onclick="saveMedication()" class="flex-1 py-5 bg-black text-white font-bold hover:bg-gray-800 transition-all">Guardar Medicaci√≥n</button>
            </div>
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        const THYROID_LIST = {
            es: ["Hipotiroidismo (Gl√°ndula lenta)", "Hipertiroidismo (Gl√°ndula acelerada)", "Hipotiroidismo Subcl√≠nico (TSH alta, pero T4 normal)", "Tiroiditis de Hashimoto (Autoinmune - Hipotiroidismo)", "Enfermedad de Graves (Autoinmune - Hipertiroidismo)", "Bocio / N√≥dulo Tiroideo (Crecimiento f√≠sico)", "Tiroiditis (Inflamaci√≥n temporal)", "Chequeo General (Sin s√≠ntomas previos)"],
            en: ["Hypothyroidism (Slow gland)", "Hyperthyroidism (Overactive gland)", "Subclinical Hypothyroidism (High TSH, normal T4)", "Hashimoto's Thyroiditis (Autoimmune - Hypo)", "Graves' Disease (Autoimmune - Hyper)", "Goiter / Thyroid Nodule (Physical growth)", "Thyroiditis (Temporary inflammation)", "General Checkup (No prior symptoms)"],
            fr: ["Hypothyro√Ødie (Glande lente)", "Hyperthyro√Ødie (Glande acc√©l√©r√©e)", "Hypothyro√Ødie infraclinique (TSH √©lev√©e, T4 normale)", "Thyro√Ødite de Hashimoto (Auto-immune - Hypo)", "Maladie de Graves (Auto-immune - Hyper)", "Goitre / Nodule thyro√Ødien (Croissance physique)", "Thyro√Ødite (Inflammation temporaire)", "Bilan g√©n√©ral (Aucun sympt√¥me)"],
            de: ["Schilddr√ºsenunterfunktion (Langsame Dr√ºse)", "Schilddr√ºsen√ºberfunktion (Beschleunigte Dr√ºse)", "Subklinische Hypothyreose (Hohes TSH, normales T4)", "Hashimoto-Thyreoiditis (Autoimmun - Unterfunktion)", "Basedow-Krankheit (Autoimmun - √úberfunktion)", "Kropf / Schilddr√ºsenknoten (Physisches Wachstum)", "Thyreoiditis (Tempor√§re Entz√ºndung)", "Allgemeine Untersuchung (Keine Symptome)"],
            it: ["Ipotiroidismo (Ghiandola lenta)", "Ipertiroidismo (Ghiandola accelerata)", "Ipotiroidismo subclinico (TSH alto, T4 normale)", "Tiroidite di Hashimoto (Autoimmune - Ipo)", "Morbido di Graves (Autoimmune - Iper)", "Gozzo / Nodulo tiroideo (Crecita fisica)", "Tiroidite (Infiammazione temporanea)", "Controllo generale (Senza sintomi)"],
            pt: ["Hipotireoidismo (Gl√¢ndula lenta)", "Hipertireoidismo (Gl√¢ndula acelerada)", "Hipotireoidismo subcl√≠nico (TSH alto, T4 normal)", "Tiroidite de Hashimoto (Autoimune - Hipotireoidismo)", "Doen√ßa de Graves (Autoimune - Hipertireoidismo)", "B√≥cio / N√≥dulo tireoidiano (Crescimento f√≠sico)", "Tiroidite (Inflama√ß√£o tempor√°ria)", "Check-up geral (Sem sintomas)"],
            nl: ["Hypothyreo√Ødie (Traage klier)", "Hyperthyreo√Ødie (Versnelde klier)", "Subklinische hypothyreo√Ødie (Hoge TSH, normale T4)", "Hashimoto thyreo√Øditits (Auto-immuun - Hypo)", "Ziekte van Graves (Auto-immuun - Hyper)", "Struma / Schildklierknobbel (Fysieke groei)", "Thyreo√Øditits (Tijdelijke ontsteking)", "Algemene controle (Geen symptomen)"],
            sv: ["Hypotyreos (L√•ngsam k√∂rtel)", "Hypertyreos (Accelererad k√∂rtel)", "Subklinisk hypotyreos (H√∂gt TSH, normalt T4)", "Hashimotos tyreoidit (Autoimmun - Hypo)", "Graves sjukdom (Autoimmun - Hyper)", "Struma / Sk√∂ldk√∂rtelknuta (Fysisk tillv√§xt)", "Tyreoidit (Tillf√§llig inflammation)", "Allm√§n kontroll (Inga symtom)"],
            pl: ["Niedoczynno≈õƒá tarczycy (Wolna tarczyca)", "Nadczynno≈õƒá tarczycy (Przyspieszona tarczyca)", "Subkliniczna niedoczynno≈õƒá (Wysokie TSH, norma T4)", "Choroba Hashimoto (Autoimmunologiczna - Niedoczynno≈õƒá)", "Choroba Gravesa-Basedowa (Autoimmunologiczna - Nadczynno≈õƒá)", "Wole / Guzek tarczycy (Wzrost fizyczny)", "Zapalenie tarczycy (Stan tymczasowy)", "Og√≥lne badanie (Brak objaw√≥w)"],
            el: ["Œ•œÄŒøŒ∏œÖœÅŒµŒøŒµŒπŒ¥ŒπœÉŒºœåœÇ (ŒëœÅŒ≥œåœÇ Œ±Œ¥Œ≠ŒΩŒ±œÇ)", "Œ•œÄŒµœÅŒ∏œÖœÅŒµŒøŒµŒπŒ¥ŒπœÉŒºœåœÇ (ŒïœÄŒπœÑŒ±œáœÖŒΩœåŒºŒµŒΩŒøœÇ Œ±Œ¥Œ≠ŒΩŒ±œÇ)", "Œ•œÄŒøŒ∫ŒªŒπŒΩŒπŒ∫œåœÇ œÖœÄŒøŒ∏œÖœÅŒµŒøŒµŒπŒ¥ŒπœÉŒºœåœÇ (Œ•œàŒ∑ŒªŒÆ TSH, Œ∫Œ±ŒΩŒøŒΩŒπŒ∫ŒÆ T4)", "ŒòœÖœÅŒµŒøŒµŒπŒ¥ŒØœÑŒπŒ¥Œ± Hashimoto (ŒëœÖœÑŒøŒ¨ŒΩŒøœÉŒø - Œ•œÄŒø)", "ŒùœåœÉŒøœÇ Graves (ŒëœÖœÑŒøŒ¨ŒΩŒøœÉŒø - Œ•œÄŒµœÅ)", "ŒíœÅŒøŒ≥œáŒøŒ∫ŒÆŒªŒ∑ / ŒåŒ∂ŒøœÇ Œ∏œÖœÅŒµŒøŒµŒπŒ¥ŒøœçœÇ (Œ¶œÖœÉŒπŒ∫ŒÆ Œ±ŒΩŒ¨œÄœÑœÖŒæŒ∑)", "ŒòœÖœÅŒµŒøŒµŒπŒ¥ŒØœÑŒπŒ¥Œ± (Œ†œÅŒøœÉœâœÅŒπŒΩŒÆ œÜŒªŒµŒ≥ŒºŒøŒΩŒÆ)", "ŒìŒµŒΩŒπŒ∫œåœÇ Œ≠ŒªŒµŒ≥œáŒøœÇ (ŒßœâœÅŒØœÇ œÉœÖŒºœÄœÑœéŒºŒ±œÑŒ±)"],
            ru: ["–ì–∏–ø–æ—Ç–∏—Ä–µ–æ–∑ (–í—è–ª–∞—è –∂–µ–ª–µ–∑–∞)", "–ì–∏–ø–µ—Ä—Ç–∏—Ä–µ–æ–∑ (–£—Å–∫–æ—Ä–µ–Ω–Ω–∞—è –∂–µ–ª–µ–∑–∞)", "–°—É–±–∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–π –≥–∏–ø–æ—Ç–∏—Ä–µ–æ–∑ (–í—ã—Å–æ–∫–∏–π –¢–¢–ì, –Ω–æ—Ä–º–∞ –¢4)", "–¢–∏—Ä–µ–æ–∏–¥–∏—Ç –•–∞—à–∏–º–æ—Ç–æ (–ê—É—Ç–æ–∏–º–º—É–Ω–Ω—ã–π - –ì–∏–ø–æ)", "–ë–æ–ª–µ–∑–Ω—å –ì—Ä–µ–π–≤—Å–∞ (–ê—É—Ç–æ–∏–º–º—É–Ω–Ω–∞—è - –ì–∏–ø–µ—Ä)", "–ó–æ–± / –£–∑–µ–ª —â–∏—Ç–æ–≤–∏–¥–Ω–æ–π –∂–µ–ª–µ–∑—ã (–§–∏–∑–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç)", "–¢–∏—Ä–µ–æ–∏–¥–∏—Ç (–í—Ä–µ–º–µ–Ω–Ω–æ–µ –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ)", "–û–±—â–µ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (–ë–µ–∑ —Å–∏–º–ø—Ç–æ–º–æ–≤)"],
            ja: ["Áî≤Áä∂ËÖ∫Ê©üËÉΩ‰Ωé‰∏ãÁóáÔºàÊ©üËÉΩ‰Ωé‰∏ãÔºâ", "Áî≤Áä∂ËÖ∫Ê©üËÉΩ‰∫¢ÈÄ≤ÁóáÔºàÊ©üËÉΩ‰∫¢ÈÄ≤Ôºâ", "ÊΩúÂú®ÊÄßÁî≤Áä∂ËÖ∫Ê©üËÉΩ‰Ωé‰∏ãÁóáÔºàTSHÈ´ò„ÄÅT4Ê≠£Â∏∏Ôºâ", "Ê©ãÊú¨ÁóÖÔºàËá™Â∑±ÂÖçÁñ´ÊÄß - ‰Ωé‰∏ãÁóáÔºâ", "„Éê„Çª„Éâ„Ç¶ÁóÖÔºàËá™Â∑±ÂÖçÁñ´ÊÄß - ‰∫¢ÈÄ≤ÁóáÔºâ", "Áî≤Áä∂ËÖ∫ËÖ´ / Áî≤Áä∂ËÖ∫ÁµêÁØÄÔºàÁâ©ÁêÜÁöÑËÇ•Â§ßÔºâ", "Áî≤Áä∂ËÖ∫ÁÇéÔºà‰∏ÄÊôÇÁöÑ„Å™ÁÇéÁóáÔºâ", "‰∏ÄËà¨„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÔºàÁóáÁä∂„Å™„ÅóÔºâ"],
            zh: ["Áî≤Áä∂ËÖ∫ÂäüËÉΩÂáèÈÄÄÔºàËÖ∫‰ΩìÁºìÊÖ¢Ôºâ", "Áî≤Áä∂ËÖ∫ÂäüËÉΩ‰∫¢ËøõÔºàËÖ∫‰ΩìÂä†ÈÄüÔºâ", "‰∫ö‰∏¥Â∫äÁî≤ÂáèÔºàTSHÈ´òÔºåT4Ê≠£Â∏∏Ôºâ", "Ê°•Êú¨Áî≤Áä∂ËÖ∫ÁÇéÔºàËá™Ë∫´ÂÖçÁñ´ - Áî≤ÂáèÔºâ", "Ê†ºÈõ∑Â§´ÊñØÁóÖÔºàËá™Ë∫´ÂÖçÁñ´ - Áî≤‰∫¢Ôºâ", "Áî≤Áä∂ËÖ∫ËÇø/ÁªìËäÇÔºàÁâ©ÁêÜÁîüÈïøÔºâ", "Áî≤Áä∂ËÖ∫ÁÇéÔºà‰∏¥Êó∂ÁÇéÁóáÔºâ", "Â∏∏ËßÑÊ£ÄÊü•ÔºàÊó†ÁóáÁä∂Ôºâ"],
            ko: ["Í∞ëÏÉÅÏÑ† Í∏∞Îä• Ï†ÄÌïòÏ¶ù (ÎäêÎ¶∞ ÏÑ†)", "Í∞ëÏÉÅÏÑ† Í∏∞Îä• Ìï≠ÏßÑÏ¶ù (Í∞ÄÏÜçÎêú ÏÑ†)", "Î∂àÌòÑÏÑ± Í∞ëÏÉÅÏÑ† Í∏∞Îä• Ï†ÄÌïòÏ¶ù (TSH ÎÜíÏùå, T4 Ï†ïÏÉÅ)", "ÌïòÏãúÎ™®ÌÜ† Í∞ëÏÉÅÏÑ†Ïóº (ÏûêÍ∏∞Î©¥Ïó≠ - Ï†ÄÌïòÏ¶ù)", "Í∑∏Î†àÏù¥Î∏åÏä§Î≥ë (ÏûêÍ∏∞Î©¥Ïó≠ - Ìï≠ÏßÑÏ¶ù)", "Í∞ëÏÉÅÏÑ†Ï¢Ö / Í∞ëÏÉÅÏÑ† Í≤∞Ï†à (Î¨ºÎ¶¨Ï†Å ÏÑ±Ïû•)", "Í∞ëÏÉÅÏÑ†Ïóº (ÏùºÏãúÏ†Å ÏóºÏ¶ù)", "ÏùºÎ∞ò Í≤ÄÏßÑ (Ï¶ùÏÉÅ ÏóÜÏùå)"],
            hi: ["‡§π‡§æ‡§á‡§™‡•ã‡§•‡§æ‡§Ø‡§∞‡§æ‡§Ø‡§°‡§ø‡§ú‡•ç‡§Æ (‡§∏‡•Å‡§∏‡•ç‡§§ ‡§ó‡•ç‡§∞‡§Ç‡§•‡§ø)", "‡§π‡§æ‡§á‡§™‡§∞‡§•‡§æ‡§Ø‡§∞‡§æ‡§Ø‡§°‡§ø‡§ú‡•ç‡§Æ (‡§§‡•á‡§ú ‡§ó‡•ç‡§∞‡§Ç‡§•‡§ø)", "‡§∏‡§¨‡§ï‡•ç‡§≤‡§ø‡§®‡•Ä‡§ï‡§≤ ‡§π‡§æ‡§á‡§™‡•ã‡§•‡§æ‡§Ø‡§∞‡§æ‡§Ø‡§°‡§ø‡§ú‡•ç‡§Æ (TSH ‡§â‡§ö‡•ç‡§ö, T4 ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø)", "‡§π‡§æ‡§∂‡§ø‡§Æ‡•ã‡§ü‡•ã ‡§•‡§æ‡§Ø‡§∞‡§æ‡§á‡§°‡§ø‡§ü‡§ø‡§∏ (‡§ë‡§ü‡•ã‡§á‡§Æ‡•ç‡§Ø‡•Ç‡§® - ‡§π‡§æ‡§á‡§™‡•ã)", "‡§ó‡•ç‡§∞‡•á‡§µ‡•ç‡§∏ ‡§∞‡•ã‡§ó (‡§ë‡§ü‡•ã‡§á‡§Æ‡•ç‡§Ø‡•Ç‡§® - ‡§π‡§æ‡§á‡§™‡§∞)", "‡§ò‡•á‡§Ç‡§ò‡§æ / ‡§•‡§æ‡§Ø‡§∞‡§æ‡§á‡§° ‡§®‡•ã‡§°‡•ç‡§Ø‡•Ç‡§≤ (‡§∂‡§æ‡§∞‡•Ä‡§∞‡§ø‡§ï ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø)", "‡§•‡§æ‡§Ø‡§∞‡§æ‡§á‡§°‡§ø‡§ü‡§ø‡§∏ (‡§Ö‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§∏‡•Ç‡§ú‡§®)", "‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ú‡§æ‡§Ç‡§ö (‡§ï‡•ã‡§à ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§®‡§π‡•Ä‡§Ç)"],
            th: ["‡∏†‡∏≤‡∏ß‡∏∞‡∏Ç‡∏≤‡∏î‡∏Æ‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏ô‡πÑ‡∏ó‡∏£‡∏≠‡∏¢‡∏î‡πå (‡∏ï‡πà‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ä‡πâ‡∏≤)", "‡∏†‡∏≤‡∏ß‡∏∞‡πÑ‡∏ó‡∏£‡∏≠‡∏¢‡∏î‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏© (‡∏ï‡πà‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡πá‡∏ß)", "‡∏†‡∏≤‡∏ß‡∏∞‡∏Ç‡∏≤‡∏î‡∏Æ‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏ô‡πÅ‡∏ù‡∏á (TSH ‡∏™‡∏π‡∏á, T4 ‡∏õ‡∏Å‡∏ï‡∏¥)", "‡πÇ‡∏£‡∏Ñ‡πÑ‡∏ó‡∏£‡∏≠‡∏¢‡∏î‡πå‡∏Æ‡∏≤‡∏ä‡∏¥‡πÇ‡∏°‡πÇ‡∏ï‡∏∞ (‡∏†‡∏π‡∏°‡∏¥‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß - ‡∏ï‡πà‡∏≥)", "‡πÇ‡∏£‡∏Ñ‡πÄ‡∏Å‡∏£‡∏ü‡∏™‡πå (‡∏†‡∏π‡∏°‡∏¥‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß - ‡∏™‡∏π‡∏á)", "‡πÇ‡∏£‡∏Ñ‡∏Ñ‡∏≠‡∏û‡∏≠‡∏Å / ‡∏Å‡πâ‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≠‡∏°‡πÑ‡∏ó‡∏£‡∏≠‡∏¢‡∏î‡πå (‡∏Å‡∏≤‡∏£‡πÇ‡∏ï‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û)", "‡∏ï‡πà‡∏≠‡∏°‡πÑ‡∏ó‡∏£‡∏≠‡∏¢‡∏î‡πå‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö (‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)", "‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£)"],
            vi: ["Suy gi√°p (Tuy·∫øn ch·∫≠m)", "C∆∞·ªùng gi√°p (Tuy·∫øn nhanh)", "Suy gi√°p c·∫≠n l√¢m s√†ng (TSH cao, T4 b√¨nh th∆∞·ªùng)", "Vi√™m tuy·∫øn gi√°p Hashimoto (T·ª± mi·ªÖn - Suy gi√°p)", "B·ªánh Graves (T·ª± mi·ªÖn - C∆∞·ªùng gi√°p)", "B∆∞·ªõu c·ªï / Nh√¢n tuy·∫øn gi√°p (Ph√°t tri·ªÉn v·∫≠t l√Ω)", "Vi√™m tuy·∫øn gi√°p (Vi√™m t·∫°m th·ªùi)", "Ki·ªÉm tra t·ªïng qu√°t (Kh√¥ng tri·ªáu ch·ª©ng)"],
            tr: ["Hipotiroidi (Yava≈ü √ßalƒ±≈üan bez)", "Hipertiroidi (Hƒ±zlƒ± √ßalƒ±≈üan bez)", "Subklinik Hipotiroidi (Y√ºksek TSH, normal T4)", "Hashimoto Tiroiditi (Otoimm√ºn - Hipotiroidi)", "Graves Hastalƒ±ƒüƒ± (Otoimm√ºn - Hipertiroidi)", "Guatr / Tiroid Nod√ºl√º (Fiziksel b√ºy√ºme)", "Tiroidit (Ge√ßici iltihaplanma)", "Genel Kontrol (Belirti yok)"],
            ar: ["ŸÇÿµŸàÿ± ÿßŸÑÿ∫ÿØÿ© ÿßŸÑÿØÿ±ŸÇŸäÿ© (ÿÆŸÖŸàŸÑ)", "ŸÅÿ±ÿ∑ ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ∫ÿØÿ© ÿßŸÑÿØÿ±ŸÇŸäÿ© (ŸÜÿ¥ÿßÿ∑ ÿ≤ÿßÿ¶ÿØ)", "ŸÇÿµŸàÿ± ÿßŸÑÿ∫ÿØÿ© ÿßŸÑÿØÿ±ŸÇŸäÿ© ÿ™ÿ≠ÿ™ ÿßŸÑÿ•ŸÉŸÑŸäŸÜŸäŸÉŸä (TSH ŸÖÿ±ÿ™ŸÅÿπÿå T4 ÿ∑ÿ®ŸäÿπŸä)", "ÿßŸÑÿ™Ÿáÿßÿ® Ÿáÿßÿ¥ŸäŸÖŸàÿ™Ÿà (ŸÖŸÜÿßÿπÿ© ÿ∞ÿßÿ™Ÿäÿ© - ŸÇÿµŸàÿ±)", "ŸÖÿ±ÿ∂ ÿ∫ÿ±ŸäŸÅÿ≤ (ŸÖŸÜÿßÿπÿ© ÿ∞ÿßÿ™Ÿäÿ© - ŸÅÿ±ÿ∑ ŸÜÿ¥ÿßÿ∑)", "ÿ™ÿ∂ÿÆŸÖ ÿßŸÑÿ∫ÿØÿ© / ÿπŸÇÿØÿ© ÿØÿ±ŸÇŸäÿ© (ŸÜŸÖŸà ÿπÿ∂ŸàŸä)", "ÿßŸÑÿ™Ÿáÿßÿ® ÿßŸÑÿ∫ÿØÿ© ÿßŸÑÿØÿ±ŸÇŸäÿ© (ÿßŸÑÿ™Ÿáÿßÿ® ŸÖÿ§ŸÇÿ™)", "ŸÅÿ≠ÿµ ÿπÿßŸÖ (ÿ®ÿØŸàŸÜ ÿ£ÿπÿ±ÿßÿ∂)"],
            he: ["◊™◊™-◊§◊¢◊ô◊ú◊ï◊™ ◊ë◊ú◊ï◊ò◊™ ◊î◊™◊®◊ô◊° (◊ë◊ú◊ï◊ò◊î ◊ê◊ô◊ò◊ô◊™)", "◊§◊¢◊ô◊ú◊ï◊™ ◊ô◊™◊® ◊©◊ú ◊ë◊ú◊ï◊ò◊™ ◊î◊™◊®◊ô◊° (◊ë◊ú◊ï◊ò◊î ◊û◊ï◊ê◊¶◊™)", "◊™◊™-◊§◊¢◊ô◊ú◊ï◊™ ◊™◊™-◊ß◊ú◊ô◊†◊ô◊™ (TSH ◊í◊ë◊ï◊î, T4 ◊™◊ß◊ô◊ü)", "◊ì◊ú◊ß◊™ ◊î◊™◊®◊ô◊° ◊¢\"◊© ◊î◊©◊ô◊û◊ï◊ò◊ï (◊ê◊ï◊ò◊ï◊ê◊ô◊û◊ï◊†◊ô - ◊™◊™)", "◊û◊ó◊ú◊™ ◊í◊®◊ô◊ô◊ë◊° (◊ê◊ï◊ò◊ï◊ê◊ô◊û◊ï◊†◊ô - ◊ô◊™◊®)", "◊ñ◊§◊ß / ◊ß◊©◊®◊ô◊™ ◊ë◊ë◊ú◊ï◊ò◊™ ◊î◊™◊®◊ô◊° (◊¶◊û◊ô◊ó◊î ◊§◊ô◊ñ◊ô◊™)", "◊ì◊ú◊ß◊™ ◊ë◊ú◊ï◊ò◊™ ◊î◊™◊®◊ô◊° (◊ì◊ú◊ß◊™ ◊ñ◊û◊†◊ô◊™)", "◊ë◊ì◊ô◊ß◊î ◊õ◊ú◊ú◊ô◊™ (◊ú◊ú◊ê ◊™◊°◊û◊ô◊†◊ô◊ù)"]
        };

        const TRANSLATIONS = {
            es: { langName: 'üá™üá∏ Espa√±ol', chooseLang: 'üåç Elige idioma:', chooseAI: 'ü§ñ Elige proveedor de IA:', enterKey: 'üîë Ingresa tu API Key:', detecting: 'üîç Detectando modelos...', chooseModel: 'ü§ñ Modelos disponibles:', chooseCondition: 'ü¶ã Selecciona tu condici√≥n:', processing: '‚è≥ Procesando PDF...', resultsTitle: 'üìä VALORACI√ìN METAB√ìLICA', markersTitle: 'üî¨ MARCADORES', patternsTitle: 'üéØ PATRONES', fullReport: 'üìã INFORME', labelCond: 'Condici√≥n:', labelMeds: 'üíä Medicaci√≥n actual para tiroides', addMedText: 'A√±adir nueva medicaci√≥n', medModalTitle: 'Registrar Medicaci√≥n Tiroidea', medImpactTitle: 'üíä Impacto de la Medicaci√≥n', triangTitle: 'üî¨ Triangulaci√≥n Avanzada (v2.0)' },
            en: { langName: 'üá∫üá∏ English', chooseLang: 'üåç Choose language:', chooseAI: 'ü§ñ Choose AI provider:', enterKey: 'üîë Enter API Key:', detecting: 'üîç Detecting...', chooseModel: 'ü§ñ Models:', chooseCondition: 'ü¶ã Condition:', processing: '‚è≥ Processing...', resultsTitle: 'üìä ASSESSMENT', markersTitle: 'üî¨ MARKERS', patternsTitle: 'üéØ PATTERNS', fullReport: 'üìã REPORT', labelCond: 'Condition:', labelMeds: 'üíä Current thyroid medication', addMedText: 'Add new medication', medModalTitle: 'Register Thyroid Medication', medImpactTitle: 'üíä Medication Impact', triangTitle: 'üî¨ Advanced Triangulation (v2.0)' },
            fr: { langName: 'üá´üá∑ Fran√ßais', chooseLang: 'üåç Choisir la langue:', chooseAI: 'ü§ñ Choisir le fournisseur:', enterKey: 'üîë Entrer la cl√© API:', detecting: 'üîç D√©tection...', chooseModel: 'ü§ñ Mod√®les:', chooseCondition: 'ü¶ã Condition:', processing: '‚è≥ Traitement...', resultsTitle: 'üìä √âVALUATION', markersTitle: 'üî¨ MARQUEURS', patternsTitle: 'üéØ MOD√àLES', fullReport: 'üìã RAPPORT', labelCond: 'Condition:', labelMeds: 'üíä M√©dication thyro√Ødienne actuelle', addMedText: 'Ajouter nouvelle m√©dication', medModalTitle: 'Enregistrer m√©dication thyro√Ødienne', medImpactTitle: 'üíä Impact du m√©dicament', triangTitle: 'üî¨ Triangulation avanc√©e (v2.0)' },
            de: { langName: 'üá©üá™ Deutsch', chooseLang: 'üåç Sprache w√§hlen:', chooseAI: 'ü§ñ KI-Anbieter w√§hlen:', enterKey: 'üîë API-Key eingeben:', detecting: 'üîç Erkennung...', chooseModel: 'ü§ñ Modelle:', chooseCondition: 'ü¶ã Zustand:', processing: '‚è≥ Verarbeitung...', resultsTitle: 'üìä BEWERTUNG', markersTitle: 'üî¨ MARKER', patternsTitle: 'üéØ MUSTER', fullReport: 'üìã BERICHT', labelCond: 'Zustand:', labelMeds: 'üíä Aktuelle Schilddr√ºsenmedikation', addMedText: 'Neue Medikation hinzuf√ºgen', medModalTitle: 'Schilddr√ºsenmedikation registrieren', medImpactTitle: 'üíä Auswirkung der Medikation', triangTitle: 'üî¨ Erweiterte Triangulation (v2.0)' },
            it: { langName: 'üáÆüáπ Italiano', chooseLang: 'üåç Scegli lingua:', chooseAI: 'ü§ñ Scegli provider IA:', enterKey: 'üîë Inserisci API Key:', detecting: 'üîç Rilevamento...', chooseModel: 'ü§ñ Modelli:', chooseCondition: 'ü¶ã Condizione:', processing: '‚è≥ Elaborazione...', resultsTitle: 'üìä VALUTAZIONE', markersTitle: 'üî¨ MARCATORI', patternsTitle: 'üéØ MODELLI', fullReport: 'üìã RAPPORTO', labelCond: 'Condizione:', labelMeds: 'üíä Medicazione tiroidea attuale', addMedText: 'Aggiungi nuova medicazione', medModalTitle: 'Registra medicazione tiroidea', medImpactTitle: 'üíä Impatto della medicazione', triangTitle: 'üî¨ Triangolazione avanzata (v2.0)' },
            pt: { langName: 'üáµüáπ Portugu√™s', chooseLang: 'üåç Escolher idioma:', chooseAI: 'ü§ñ Escolher provedor de IA:', enterKey: 'üîë Digite sua API Key:', detecting: 'üîç Detectando...', chooseModel: 'ü§ñ Modelos:', chooseCondition: 'ü¶ã Condi√ß√£o:', processing: '‚è≥ Processando...', resultsTitle: 'üìä AVALIA√á√ÉO', markersTitle: 'üî¨ MARCADORES', patternsTitle: 'üéØ PADR√ïES', fullReport: 'üìã RELAT√ìRIO', labelCond: 'Condi√ß√£o:', labelMeds: 'üíä Medica√ß√£o tireoidiana atual', addMedText: 'Adicionar nova medica√ß√£o', medModalTitle: 'Registrar medica√ß√£o tireoidiana', medImpactTitle: 'üíä Impacto da medica√ß√£o', triangTitle: 'üî¨ Triangula√ß√£o avan√ßada (v2.0)' },
            nl: { langName: 'üá≥üá± Nederlands', chooseLang: 'üåç Kies taal:', chooseAI: 'ü§ñ Kies AI-provider:', enterKey: 'üîë Voer API Key in:', detecting: 'üîç Detecteren...', chooseModel: 'ü§ñ Modellen:', chooseCondition: 'ü¶ã Conditie:', processing: '‚è≥ Verwerken...', resultsTitle: 'üìä BEOORDELING', markersTitle: 'üî¨ MARKERS', patternsTitle: 'üéØ PATRONEN', fullReport: 'üìã RAPPORT', labelCond: 'Conditie:', labelMeds: 'üíä Huidige schildkliermedicatie', addMedText: 'Nieuwe medicatie toevoegen', medModalTitle: 'Schildkliermedicatie registreren', medImpactTitle: 'üíä Impact van medicatie', triangTitle: 'üî¨ Geavanceerde triangulatie (v2.0)' },
            sv: { langName: 'üá∏üá™ Svenska', chooseLang: 'üåç V√§lj spr√•k:', chooseAI: 'ü§ñ V√§lj AI-leverant√∂r:', enterKey: 'üîë Ange API-nyckel:', detecting: 'üîç Detekterar...', chooseModel: 'ü§ñ Modeller:', chooseCondition: 'ü¶ã Tillst√•nd:', processing: '‚è≥ Bearbetar...', resultsTitle: 'üìä BED√ñMNING', markersTitle: 'üî¨ MARK√ñRER', patternsTitle: 'üéØ M√ñNSTER', fullReport: 'üìã RAPPORT', labelCond: 'Tillst√•nd:', labelMeds: 'üíä Aktuell sk√∂ldk√∂rtelmedicinering', addMedText: 'L√§gg till ny medicinering', medModalTitle: 'Registrera sk√∂ldk√∂rtelmedicinering', medImpactTitle: 'üíä Effekt av medicineringen', triangTitle: 'üî¨ Avancerad triangulering (v2.0)' },
            pl: { langName: 'üáµüá± Polski', chooseLang: 'üåç Wybierz jƒôzyk:', chooseAI: 'ü§ñ Wybierz dostawcƒô AI:', enterKey: 'üîë Wprowad≈∫ klucz API:', detecting: 'üîç Wykrywanie...', chooseModel: 'ü§ñ Modele:', chooseCondition: 'ü¶ã Stan:', processing: '‚è≥ Przetwarzanie...', resultsTitle: 'üìä OCENA', markersTitle: 'üî¨ MARKERY', patternsTitle: 'üéØ WZORCE', fullReport: 'üìã RAPPORT', labelCond: 'Stan:', labelMeds: 'üíä Aktualna medykacja tarczycy', addMedText: 'Dodaj nowƒÖ medykacjƒô', medModalTitle: 'Zarejestruj medykacjƒô tarczycy', medImpactTitle: 'üíä Wp≈Çyw medykacji', triangTitle: 'üî¨ Zaawansowana triangulacja (v2.0)' },
            el: { langName: 'üá¨üá∑ ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨', chooseLang: 'üåç ŒïœÄŒπŒªŒøŒ≥ŒÆ Œ≥ŒªœéœÉœÉŒ±œÇ:', chooseAI: 'ü§ñ ŒïœÄŒπŒªŒøŒ≥ŒÆ œÄŒ±œÅœåœáŒøœÖ AI:', enterKey: 'üîë ŒïŒπœÉŒ±Œ≥œâŒ≥ŒÆ API Key:', detecting: 'üîç ŒëŒΩŒØœáŒΩŒµœÖœÉŒ∑...', chooseModel: 'ü§ñ ŒúŒøŒΩœÑŒ≠ŒªŒ±:', chooseCondition: 'ü¶ã ŒöŒ±œÑŒ¨œÉœÑŒ±œÉŒ∑:', processing: '‚è≥ ŒïœÄŒµŒæŒµœÅŒ≥Œ±œÉŒØŒ±...', resultsTitle: 'üìä ŒëŒûŒôŒüŒõŒüŒìŒóŒ£Œó', markersTitle: 'üî¨ ŒîŒïŒôŒöŒ§ŒïŒ£', patternsTitle: 'üéØ Œ†Œ°ŒüŒ§Œ•Œ†Œë', fullReport: 'üìã ŒëŒùŒëŒ¶ŒüŒ°Œë', labelCond: 'ŒöŒ±œÑŒ¨œÉœÑŒ±œÉŒ∑:', labelMeds: 'üíä Œ§œÅŒ≠œáŒøœÖœÉŒ± œÜŒ±œÅŒºŒ±Œ∫ŒµœÖœÑŒπŒ∫ŒÆ Œ±Œ≥œâŒ≥ŒÆ Œ∏œÖœÅŒµŒøŒµŒπŒ¥ŒøœçœÇ', addMedText: 'Œ†œÅŒøœÉŒ∏ŒÆŒ∫Œ∑ ŒΩŒ≠Œ±œÇ œÜŒ±œÅŒºŒ±Œ∫ŒµœÖœÑŒπŒ∫ŒÆœÇ', medModalTitle: 'ŒöŒ±œÑŒ±œáœéœÅŒπœÉŒ∑ œÜŒ±œÅŒºŒ±Œ∫ŒµœÖœÑŒπŒ∫ŒÆœÇ Œ±Œ≥œâŒ≥ŒÆœÇ Œ∏œÖœÅŒµŒøŒµŒπŒ¥ŒøœçœÇ', medImpactTitle: 'üíä ŒïœÄŒØŒ¥œÅŒ±œÉŒ∑ œÜŒ±œÅŒºŒ±Œ∫ŒµœÖœÑŒπŒ∫ŒÆœÇ Œ±Œ≥œâŒ≥ŒÆœÇ', triangTitle: 'üî¨ Œ†œÅŒøŒ∑Œ≥ŒºŒ≠ŒΩŒ∑ Œ§œÅŒπŒ≥œâŒΩŒøœÄŒøŒØŒ∑œÉŒ∑ (v2.0)' },
            ru: { langName: 'üá∑üá∫ –†—É—Å—Å–∫–∏–π', chooseLang: 'üåç –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:', chooseAI: 'ü§ñ –í—ã–±–µ—Ä–∏—Ç–µ –ò–ò:', enterKey: 'üîë –í–≤–µ–¥–∏—Ç–µ API Key:', detecting: 'üîç –ü–æ–∏—Å–∫...', chooseModel: 'ü§ñ –ú–æ–¥–µ–ª–∏:', chooseCondition: 'ü¶ã –°–æ—Å—Ç–æ—è–Ω–∏–µ:', processing: '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...', resultsTitle: 'üìä –û–¶–ï–ù–ö–ê', markersTitle: 'üî¨ –ú–ê–†–ö–ï–†–´', patternsTitle: 'üéØ –ü–ê–¢–¢–ï–†–ù–´', fullReport: 'üìã –û–¢–ß–ï–¢', labelCond: '–°–æ—Å—Ç–æ—è–Ω–∏–µ:', labelMeds: 'üíä –¢–µ–∫—É—â–∞—è —Ç–µ—Ä–∞–ø–∏—è —â–∏—Ç–æ–≤–∏–¥–Ω–æ–π –∂–µ–ª–µ–∑—ã', addMedText: '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –º–µ–¥–∏–∫–∞—Ü–∏—é', medModalTitle: '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ–¥–∏–∫–∞—Ü–∏—é —â–∏—Ç–æ–≤–∏–¥–Ω–æ–π –∂–µ–ª–µ–∑—ã', medImpactTitle: 'üíä –í–ª–∏—è–Ω–∏–µ –º–µ–¥–∏–∫–∞—Ü–∏–∏', triangTitle: 'üî¨ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ç—Ä–∏–∞–Ω–≥—É–ª—è—Ü–∏—è (v2.0)' },
            ja: { langName: 'üáØüáµ Êó•Êú¨Ë™û', chooseLang: 'üåç Ë®ÄË™û„ÇíÈÅ∏Êäû:', chooseAI: 'ü§ñ AI„Éó„É≠„Éê„Ç§„ÉÄ„Éº„ÇíÈÅ∏Êäû:', enterKey: 'üîë API„Ç≠„Éº„ÇíÂÖ•Âäõ:', detecting: 'üîç Ê§úÂá∫‰∏≠...', chooseModel: 'ü§ñ „É¢„Éá„É´:', chooseCondition: 'ü¶ã Áä∂ÊÖã:', processing: '‚è≥ Âá¶ÁêÜ‰∏≠...', resultsTitle: 'üìä Ë©ï‰æ°', markersTitle: 'üî¨ „Éû„Éº„Ç´„Éº', patternsTitle: 'üéØ „Éë„Çø„Éº„É≥', fullReport: 'üìã „É¨„Éù„Éº„Éà', labelCond: 'Áä∂ÊÖã:', labelMeds: 'üíä ÁèæÂú®„ÅÆÁî≤Áä∂ËÖ∫Ëñ¨', addMedText: 'Êñ∞„Åó„ÅÑËñ¨„ÇíËøΩÂä†', medModalTitle: 'Áî≤Áä∂ËÖ∫Ëñ¨„ÇíÁôªÈå≤', medImpactTitle: 'üíä Ëñ¨„ÅÆÂΩ±Èüø', triangTitle: 'üî¨ È´òÂ∫¶„Å™‰∏âËßíÊ∏¨Èáè (v2.0)' },
            zh: { langName: 'üá®üá≥ ‰∏≠Êñá', chooseLang: 'üåç ÈÄâÊã©ËØ≠Ë®Ä:', chooseAI: 'ü§ñ ÈÄâÊã© AI Êèê‰æõÂïÜ:', enterKey: 'üîë ËæìÂÖ• API Key:', detecting: 'üîç Ê£ÄÊµã‰∏≠...', chooseModel: 'ü§ñ Ê®°Âûã:', chooseCondition: 'ü¶ã Áä∂ÂÜµ:', processing: '‚è≥ Â§ÑÁêÜ‰∏≠...', resultsTitle: 'üìä ËØÑ‰º∞', markersTitle: 'üî¨ ÊåáÊ†á', patternsTitle: 'üéØ Ê®°Âºè', fullReport: 'üìã Êä•Âëä', labelCond: 'Áä∂ÂÜµ:', labelMeds: 'üíä ÂΩìÂâçÁî≤Áä∂ËÖ∫Áî®ËçØ', addMedText: 'Ê∑ªÂä†Êñ∞ËçØÁâ©', medModalTitle: 'Ê≥®ÂÜåÁî≤Áä∂ËÖ∫ËçØÁâ©', medImpactTitle: 'üíä ËçØÁâ©ÂΩ±Âìç', triangTitle: 'üî¨ È´òÁ∫ß‰∏âËßíÂàÜÊûê (v2.0)' },
            ko: { langName: 'üá∞üá∑ ÌïúÍµ≠Ïñ¥', chooseLang: 'üåç Ïñ∏Ïñ¥ ÏÑ†ÌÉù:', chooseAI: 'ü§ñ AI Ï†úÍ≥µÏóÖÏ≤¥ ÏÑ†ÌÉù:', enterKey: 'üîë API ÌÇ§ ÏûÖÎ†•:', detecting: 'üîç Í∞êÏßÄ Ï§ë...', chooseModel: 'ü§ñ Î™®Îç∏:', chooseCondition: 'ü¶ã ÏÉÅÌÉú:', processing: '‚è≥ Ï≤òÎ¶¨ Ï§ë...', resultsTitle: 'üìä ÌèâÍ∞Ä', markersTitle: 'üî¨ ÎßàÏª§', patternsTitle: 'üéØ Ìå®ÌÑ¥', fullReport: 'üìã Î≥¥Í≥†ÏÑú', labelCond: 'ÏÉÅÌÉú:', labelMeds: 'üíä ÌòÑÏû¨ Í∞ëÏÉÅÏÑ† ÏïΩÎ¨º', addMedText: 'ÏÉàÎ°úÏö¥ ÏïΩÎ¨º Ï∂îÍ∞Ä', medModalTitle: 'Í∞ëÏÉÅÏÑ† ÏïΩÎ¨º Îì±Î°ù', medImpactTitle: 'üíä ÏïΩÎ¨º ÏòÅÌñ•', triangTitle: 'üî¨ Í≥†Í∏â ÏÇºÍ∞Å Ï∏°Îüâ (v2.0)' },
            hi: { langName: 'üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä', chooseLang: 'üåç ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç:', chooseAI: 'ü§ñ AI ‡§™‡•ç‡§∞‡§¶‡§æ‡§§‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç:', enterKey: 'üîë API Key ‡§°‡§æ‡§≤‡•á‡§Ç:', detecting: 'üîç ‡§™‡§§‡§æ ‡§≤‡§ó‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...', chooseModel: 'ü§ñ ‡§Æ‡•â‡§°‡§≤:', chooseCondition: 'ü¶ã ‡§∏‡•ç‡§•‡§ø‡§§‡§ø:', processing: '‚è≥ ‡§™‡•ç‡§∞‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£...', resultsTitle: 'üìä ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§®', markersTitle: 'üî¨ ‡§Æ‡§æ‡§∞‡•ç‡§ï‡§∞', patternsTitle: 'üéØ ‡§™‡•à‡§ü‡§∞‡•ç‡§®', fullReport: 'üìã ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü', labelCond: '‡§∏‡•ç‡§•‡§ø‡§§‡§ø:', labelMeds: 'üíä ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§•‡§æ‡§Ø‡§∞‡•â‡§á‡§° ‡§¶‡§µ‡§æ', addMedText: '‡§®‡§à ‡§¶‡§µ‡§æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç', medModalTitle: '‡§•‡§æ‡§Ø‡§∞‡•â‡§á‡§° ‡§¶‡§µ‡§æ ‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§ï‡§∞‡•á‡§Ç', medImpactTitle: 'üíä ‡§¶‡§µ‡§æ ‡§ï‡§æ ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ', triangTitle: 'üî¨ ‡§â‡§®‡•ç‡§®‡§§ ‡§ü‡•ç‡§∞‡§æ‡§Ø‡§Ç‡§ó‡•Å‡§≤‡•á‡§∂‡§® (v2.0)' },
            th: { langName: 'üáπüá≠ ‡πÑ‡∏ó‡∏¢', chooseLang: 'üåç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏©‡∏≤:', chooseAI: 'ü§ñ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ AI:', enterKey: 'üîë ‡πÉ‡∏™‡πà API Key:', detecting: 'üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤...', chooseModel: 'ü§ñ ‡∏£‡∏∏‡πà‡∏ô:', chooseCondition: 'ü¶ã ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:', processing: '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...', resultsTitle: 'üìä ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô', markersTitle: 'üî¨ ‡∏ï‡∏±‡∏ß‡∏ö‡πà‡∏á‡∏ä‡∏µ‡πâ', patternsTitle: 'üéØ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö', fullReport: 'üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', labelCond: '‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:', labelMeds: 'üíä ‡∏¢‡∏≤‡πÑ‡∏ó‡∏£‡∏≠‡∏¢‡∏î‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô', addMedText: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà', medModalTitle: '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏¢‡∏≤‡πÑ‡∏ó‡∏£‡∏≠‡∏¢‡∏î‡πå', medImpactTitle: 'üíä ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡∏≠‡∏á‡∏¢‡∏≤', triangTitle: 'üî¨ ‡∏Å‡∏≤‡∏£‡πÑ‡∏ï‡∏£‡πà‡∏ï‡∏£‡∏≠‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á (v2.0)' },
            vi: { langName: 'üáªüá≥ Ti·∫øng Vi·ªát', chooseLang: 'üåç Ch·ªçn ng√¥n ng·ªØ:', chooseAI: 'ü§ñ Ch·ªçn nh√† cung c·∫•p AI:', enterKey: 'üîë Nh·∫≠p API Key:', detecting: 'üîç ƒêang d√≤ t√¨m...', chooseModel: 'ü§ñ M√¥ h√¨nh:', chooseCondition: 'ü¶ã T√¨nh tr·∫°ng:', processing: '‚è≥ ƒêang x·ª≠ l√Ω...', resultsTitle: 'üìä ƒê√ÅNH GI√Å', markersTitle: 'üî¨ CH·ªà S·ªê', patternsTitle: 'üéØ M·∫™U', fullReport: 'üìã B√ÅO C√ÅO', labelCond: 'T√¨nh tr·∫°ng:', labelMeds: 'üíä Thu·ªëc tuy·∫øn gi√°p hi·ªán t·∫°i', addMedText: 'Th√™m thu·ªëc m·ªõi', medModalTitle: 'ƒêƒÉng k√Ω thu·ªëc tuy·∫øn gi√°p', medImpactTitle: 'üíä T√°c ƒë·ªông c·ªßa thu·ªëc', triangTitle: 'üî¨ Tam gi√°c h√≥a n√¢ng cao (v2.0)' },
            tr: { langName: 'üáπüá∑ T√ºrk√ße', chooseLang: 'üåç Dil se√ßin:', chooseAI: 'ü§ñ AI saƒülayƒ±cƒ± se√ßin:', enterKey: 'üîë API Anahtarƒ±nƒ± girin:', detecting: 'üîç Tespit ediliyor...', chooseModel: 'ü§ñ Modeller:', chooseCondition: 'ü¶ã Durum:', processing: '‚è≥ ƒ∞≈üleniyor...', resultsTitle: 'üìä DEƒûERLENDƒ∞RME', markersTitle: 'üî¨ BELƒ∞RTE√áLER', patternsTitle: 'üéØ DESENLER', fullReport: 'üìã RAPOR', labelCond: 'Durum:', labelMeds: 'üíä Mevcut tiroid ilacƒ±', addMedText: 'Yeni ila√ß ekle', medModalTitle: 'Tiroid ilacƒ±nƒ± kaydet', medImpactTitle: 'üíä ƒ∞la√ß etkisi', triangTitle: 'üî¨ Geli≈ümi≈ü Triang√ºlasyon (v2.0)' },
            ar: { langName: 'üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', chooseLang: 'üåç ÿßÿÆÿ™ÿ± ÿßŸÑŸÑÿ∫ÿ©:', chooseAI: 'ü§ñ ÿßÿÆÿ™ÿ± ŸÖÿ≤ŸàÿØ ÿßŸÑÿ∞ŸÉÿßÿ°:', enterKey: 'üîë ÿ£ÿØÿÆŸÑ ŸÖŸÅÿ™ÿßÿ≠ API:', detecting: 'üîç ÿ¨ÿßÿ±Ÿä ÿßŸÑŸÉÿ¥ŸÅ...', chooseModel: 'ü§ñ ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨:', chooseCondition: 'ü¶ã ÿßŸÑÿ≠ÿßŸÑÿ©:', processing: '‚è≥ ÿ¨ÿßÿ±Ÿä ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©...', resultsTitle: 'üìä ÿßŸÑÿ™ŸÇŸäŸäŸÖ', markersTitle: 'üî¨ ÿßŸÑŸÖÿ§ÿ¥ÿ±ÿßÿ™', patternsTitle: 'üéØ ÿßŸÑÿ£ŸÜŸÖÿßÿ∑', fullReport: 'üìã ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±', labelCond: 'ÿßŸÑÿ≠ÿßŸÑÿ©:', labelMeds: 'üíä ÿßŸÑÿØŸàÿßÿ° ÿßŸÑÿ≠ÿßŸÑŸä ŸÑŸÑÿ∫ÿØÿ© ÿßŸÑÿØÿ±ŸÇŸäÿ©', addMedText: 'ÿ•ÿ∂ÿßŸÅÿ© ÿØŸàÿßÿ° ÿ¨ÿØŸäÿØ', medModalTitle: 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØŸàÿßÿ° ÿßŸÑÿ∫ÿØÿ© ÿßŸÑÿØÿ±ŸÇŸäÿ©', medImpactTitle: 'üíä ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿØŸàÿßÿ°', triangTitle: 'üî¨ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ´ŸÑÿßÿ´Ÿä ÿßŸÑŸÖÿ™ŸÇÿØŸÖ (v2.0)' },
            he: { langName: 'üáÆüá± ◊¢◊ë◊®◊ô◊™', chooseLang: 'üåç ◊ë◊ó◊® ◊©◊§◊î:', chooseAI: 'ü§ñ ◊ë◊ó◊® ◊°◊§◊ß ◊ë◊ô◊†◊î ◊û◊ú◊ê◊õ◊ô◊™:', enterKey: 'üîë ◊î◊ñ◊ü ◊û◊§◊™◊ó API:', detecting: 'üîç ◊û◊ñ◊î◊î...', chooseModel: 'ü§ñ ◊û◊ï◊ì◊ú◊ô◊ù:', chooseCondition: 'ü¶ã ◊û◊¶◊ë:', processing: '‚è≥ ◊û◊¢◊ë◊ì...', resultsTitle: 'üìä ◊î◊¢◊®◊õ◊î', markersTitle: 'üî¨ ◊°◊û◊†◊ô◊ù', patternsTitle: 'üéØ ◊ì◊§◊ï◊°◊ô◊ù', fullReport: 'üìã ◊ì◊ï◊ó', labelCond: '◊û◊¶◊ë:', labelMeds: 'üíä ◊™◊®◊ï◊§◊î ◊†◊ï◊õ◊ó◊ô◊™ ◊ú◊ë◊ú◊ï◊ò◊™ ◊î◊™◊®◊ô◊°', addMedText: '◊î◊ï◊°◊£ ◊™◊®◊ï◊§◊î ◊ó◊ì◊©◊î', medModalTitle: '◊®◊©◊ï◊ù ◊™◊®◊ï◊§◊î ◊ú◊ë◊ú◊ï◊ò◊™ ◊î◊™◊®◊ô◊°', medImpactTitle: 'üíä ◊î◊©◊§◊¢◊™ ◊î◊™◊®◊ï◊§◊î', triangTitle: 'üî¨ ◊ò◊®◊ô◊ê◊†◊í◊ï◊ú◊¶◊ô◊î ◊û◊™◊ß◊ì◊û◊™ (v2.0)' }
        };

        const PROVIDER_CONFIG = { /* exactamente el mismo */ 
            openai: { name: 'OpenAI', base: 'https://api.openai.com/v1/chat/completions', modelsUrl: 'https://api.openai.com/v1/models', headers: k => ({ Authorization: `Bearer ${k}` }) },
            groq: { name: 'Groq (Qwen)', base: 'https://api.groq.com/openai/v1/chat/completions', modelsUrl: 'https://api.groq.com/openai/v1/models', headers: k => ({ Authorization: `Bearer ${k}` }) },
            anthropic: { name: 'Claude (Anthropic)', base: 'https://api.anthropic.com/v1/messages', modelsUrl: 'https://api.anthropic.com/v1/models', headers: k => ({ 'x-api-key': k, 'anthropic-version': '2023-06-01' }) },
            gemini: { name: 'Gemini', base: 'https://generativelanguage.googleapis.com/v1beta/models/', modelsUrl: 'https://generativelanguage.googleapis.com/v1beta/models', headers: k => ({}) },
            xai: { name: 'Grok (xAI)', base: 'https://api.x.ai/v1/chat/completions', modelsUrl: 'https://api.x.ai/v1/models', headers: k => ({ Authorization: `Bearer ${k}` }) },
            ollama: { name: 'Ollama (Local)', base: 'http://127.0.0.1:11434/api/chat', modelsUrl: 'http://127.0.0.1:11434/api/tags', headers: k => ({}) }
        };

        // === PROTOCOLO MAESTRO v2.0 - TRIANGULACI√ìN PROFESIONAL + IMPACTO DE MEDICACI√ìN ===
        const PROTOCOLO_MAESTRO = `Eres endocrin√≥logo funcional de √©lite. PROTOCOLO MAESTRO DE TRIANGULACI√ìN METAB√ìLICA v2.0 (Nivel Cl√≠nico Profesional):

1. Eje Hipofisario-Tiroideo (TSH + relaci√≥n con FT4/FT3)
2. Conversi√≥n perif√©rica y freno (FT3, rT3, ratio FT3/rT3, FT3/FT4)
3. Autoinmunidad y transporte
4. Rangos √≥ptimos funcionales (TSH 0.5-2.0, FT4 1.2-1.8 ng/dL, FT3 3.2-4.2 pg/mL, etc.)
5. IMPACTO ESPEC√çFICO DE MEDICACI√ìN (obligatorio):
   - Levotiroxina ‚Üí suprime TSH, eleva FT4, puede bajar FT3 si conversi√≥n pobre
   - Liotironina / NDT ‚Üí eleva FT3 directamente
   - Antitiroideos ‚Üí reducen producci√≥n
   - Otros (betabloqueantes, litio, etc.)
6. Patrones avanzados: Low T3 syndrome, Reverse T3 dominance, Peripheral resistance, Central hypothyroidism, Wilson‚Äôs temp. syndrome, etc.

Paciente en: [CONDICI√ìN]. Medicaci√≥n actual: [MEDS].

PDF: [PDF_TEXT]

Devuelve √öNICAMENTE este JSON v√°lido y nada m√°s:
{
  "markers": [{"name":"TSH","score":7,"summary":"... contextual con medicaci√≥n"}],
  "patterns": ["Poor T4‚ÜíT3 conversion","rT3 dominance"],
  "medImpact": "La levotiroxina 125 mcg est√° elevando FT4 pero la conversi√≥n es sub√≥ptima (FT3 bajo). Sugiero a√±adir 5-10 mcg liotironina o selenio 200 mcg.",
  "triangulation": "Triangulaci√≥n completa: hipotiroidismo subcl√≠nico + conversi√≥n alterada + medicaci√≥n parcialmente efectiva.",
  "fullReport": "Informe narrativo profesional largo..."
}`;

        let currentLang = 'es';
        let currentProvider = '';
        let currentKey = '';
        let currentModel = '';
        let currentMeds = JSON.parse(localStorage.getItem('thyroid_meds')) || [];

        function setStep(step) {
            document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
            const target = document.getElementById(typeof step === 'string' ? step : `step-${step}`);
            if (target) target.classList.add('active');
        }

        // === CARGA DE IDIOMAS (igual que antes) ===
        const langGrid = document.getElementById('lang-grid');
        Object.keys(TRANSLATIONS).forEach(key => {
            const btn = document.createElement('button');
            btn.className = "bg-white border border-gray-100 p-4 rounded-xl font-semibold hover:border-black transition-all";
            btn.innerText = TRANSLATIONS[key].langName;
            btn.onclick = () => { currentLang = key; checkSavedAI(); };
            langGrid.appendChild(btn);
        });

        function checkSavedAI() {
            const saved = JSON.parse(localStorage.getItem('thyroid_ai_config'));
            if (saved && saved.provider && (saved.key || saved.provider === 'ollama') && saved.model) {
                currentProvider = saved.provider;
                currentKey = saved.key;
                currentModel = saved.model;
                showAIStatus();
                startStep4();
            } else {
                startStep2();
            }
        }

        function showAIStatus() {
            const tag = document.getElementById('ai-status-tag');
            const name = document.getElementById('saved-ai-name');
            name.innerText = `${PROVIDER_CONFIG[currentProvider].name} (${currentModel})`;
            tag.classList.remove('hidden');
        }

        function clearAISettings() {
            localStorage.removeItem('thyroid_ai_config');
            document.getElementById('ai-status-tag').classList.add('hidden');
            startStep2();
        }

        function startStep2() {
            document.getElementById('title-step-2').innerText = TRANSLATIONS[currentLang].chooseAI;
            const grid = document.getElementById('provider-grid');
            grid.innerHTML = '';
            Object.keys(PROVIDER_CONFIG).forEach(key => {
                const btn = document.createElement('button');
                btn.className = "w-full border border-gray-100 p-4 rounded-xl text-left font-bold flex justify-between hover:bg-gray-50";
                btn.innerHTML = `<span>${PROVIDER_CONFIG[key].name}</span> <span>‚Üí</span>`;
                btn.onclick = () => { currentProvider = key; startStep3(); };
                grid.appendChild(btn);
            });
            setStep(2);
        }

        function startStep3() {
            document.getElementById('title-step-3').innerText = TRANSLATIONS[currentLang].enterKey;
            document.getElementById('label-models').innerText = TRANSLATIONS[currentLang].chooseModel;
            const keyCont = document.getElementById('api-key-container');
            if(currentProvider === 'ollama') keyCont.classList.add('hidden');
            else keyCont.classList.remove('hidden');
            setStep(3);
        }

        document.getElementById('btn-sync').onclick = async () => {
            const btn = document.getElementById('btn-sync');
            currentKey = document.getElementById('api-key').value;
            btn.innerText = TRANSLATIONS[currentLang].detecting;
            
            try {
                let models = [];
                const cfg = PROVIDER_CONFIG[currentProvider];
                if(currentProvider === 'ollama') {
                    const r = await fetch(cfg.modelsUrl);
                    const d = await r.json();
                    models = d.models.map(m => m.name);
                } else {
                    let url = cfg.modelsUrl;
                    if (currentProvider === 'gemini') url += `?key=${currentKey}`;
                    const r = await fetch(url, { headers: cfg.headers(currentKey) });
                    const d = await r.json();
                    models = (d.data || d.models).map(m => currentProvider === 'gemini' ? m.name.split('/').pop() : m.id);
                }
                const select = document.getElementById('model-select');
                select.innerHTML = models.map(m => `<option value="${m}">${m}</option>`).join('');
                document.getElementById('model-container').classList.remove('hidden');
                btn.innerText = "Continue & Save ‚Üí";
                btn.onclick = () => {
                    currentModel = document.getElementById('model-select').value;
                    localStorage.setItem('thyroid_ai_config', JSON.stringify({ provider: currentProvider, key: currentKey, model: currentModel }));
                    showAIStatus();
                    startStep4();
                };
            } catch (e) {
                alert("Connection failed. Check your Key.");
                btn.innerText = "Sync Models";
            }
        };

        function startStep4() {
            const t = TRANSLATIONS[currentLang];
            document.getElementById('title-step-4').innerText = t.chooseCondition;
            document.getElementById('label-condition').innerText = t.labelCond;
            document.getElementById('label-meds').innerText = t.labelMeds;
            document.getElementById('add-med-text').innerText = t.addMedText;

            const select = document.getElementById('condition-select');
            const conds = THYROID_LIST[currentLang] || THYROID_LIST['en'];
            select.innerHTML = conds.map(c => `<option value="${c}">${c}</option>`).join('');

            renderCurrentMeds();
            setStep(4);
        }

        // === GESTI√ìN DE MEDICACI√ìN ===
        function renderCurrentMeds() {
            const container = document.getElementById('meds-list');
            container.innerHTML = '';
            if (currentMeds.length === 0) {
                container.innerHTML = `<p class="text-gray-400 text-sm italic">Sin medicaci√≥n registrada a√∫n</p>`;
                return;
            }
            currentMeds.forEach((med, i) => {
                const div = document.createElement('div');
                div.className = "med-chip flex items-center justify-between bg-gray-50 border border-gray-100 p-4 rounded-2xl";
                div.innerHTML = `
                    <div>
                        <div class="font-semibold">${med.type} ‚Äî ${med.name}</div>
                        <div class="text-xs text-gray-500">${med.dose} ${med.freq} ‚Ä¢ desde ${med.start || '‚Äî'}</div>
                    </div>
                    <button onclick="deleteMed(${i}); event.stopImmediatePropagation();" class="text-red-400 hover:text-red-600 text-xl leading-none">√ó</button>
                `;
                container.appendChild(div);
            });
        }

        function openMedModal() {
            const t = TRANSLATIONS[currentLang];
            document.getElementById('med-modal-title').innerText = t.medModalTitle;
            document.getElementById('med-modal').classList.remove('hidden');
            // limpiar campos
            document.getElementById('med-name').value = '';
            document.getElementById('med-dose').value = '';
            document.getElementById('med-notes').value = '';
        }

        function closeMedModal() {
            document.getElementById('med-modal').classList.add('hidden');
        }

        function saveMedication() {
            const type = document.getElementById('med-type').value;
            const name = document.getElementById('med-name').value.trim() || 'Sin nombre';
            const dose = document.getElementById('med-dose').value.trim();
            const freq = document.getElementById('med-freq').value.trim() || 'Diaria';
            const start = document.getElementById('med-start').value;
            const notes = document.getElementById('med-notes').value.trim();

            currentMeds.push({ type, name, dose, freq, start, notes });
            localStorage.setItem('thyroid_meds', JSON.stringify(currentMeds));
            renderCurrentMeds();
            closeMedModal();
        }

        function deleteMed(index) {
            if (confirm('¬øEliminar esta medicaci√≥n?')) {
                currentMeds.splice(index, 1);
                localStorage.setItem('thyroid_meds', JSON.stringify(currentMeds));
                renderCurrentMeds();
            }
        }

        document.getElementById('pdf-file').onchange = (e) => {
            if(e.target.files[0]) {
                document.getElementById('file-name').innerText = e.target.files[0].name;
                document.getElementById('pdf-label').classList.add('hidden');
            }
        };

        document.getElementById('btn-analyze').onclick = async () => {
            const file = document.getElementById('pdf-file').files[0];
            if(!file) return alert("Por favor selecciona un PDF");
            document.getElementById('loading-text').innerText = TRANSLATIONS[currentLang].processing;
            setStep('step-loading');

            const reader = new FileReader();
            reader.onload = async function() {
                const typedarray = new Uint8Array(this.result);
                const pdf = await pdfjsLib.getDocument(typedarray).promise;
                let text = "";
                for(let i=1; i<=pdf.numPages; i++){
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    text += content.items.map(s => s.str).join(" ");
                }
                runAnalysis(text);
            };
            reader.readAsArrayBuffer(file);
        };

        async function runAnalysis(pdfText) {
            const condition = document.getElementById('condition-select').value;
            const medsStr = currentMeds.length ? JSON.stringify(currentMeds) : "Ninguna medicaci√≥n registrada";

            let prompt = PROTOCOLO_MAESTRO
                .replace('[CONDICI√ìN]', condition)
                .replace('[MEDS]', medsStr)
                .replace('[PDF_TEXT]', pdfText);

            try {
                const cfg = PROVIDER_CONFIG[currentProvider];
                let body, url = cfg.base;
                if(currentProvider === 'gemini') {
                    url += `${currentModel}:generateContent?key=${currentKey}`;
                    body = { contents: [{ parts: [{ text: prompt }] }] };
                } else {
                    body = { model: currentModel, messages: [{ role: 'user', content: prompt }], stream: false };
                }
                const res = await fetch(url, { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json', ...cfg.headers(currentKey) }, 
                    body: JSON.stringify(body) 
                });
                const d = await res.json();
                let raw = currentProvider === 'gemini' ? d.candidates[0].content.parts[0].text : 
                          (currentProvider === 'ollama' ? d.message.content : d.choices[0].message.content);
                
                const jsonMatch = raw.match(/\{[\s\S]*\}/);
                const data = JSON.parse(jsonMatch ? jsonMatch[0] : raw);
                renderDashboard(data, condition);
            } catch (e) { 
                console.error(e); 
                alert("Error en an√°lisis. Revisa consola."); 
                setStep(4); 
            }
        }

        function renderDashboard(data, condition) {
            setStep('dashboard');
            const t = TRANSLATIONS[currentLang];
            document.getElementById('dash-res-title').innerText = t.resultsTitle;
            document.getElementById('dash-condition').innerText = condition;
            document.getElementById('dash-markers-title').innerText = t.markersTitle;
            document.getElementById('dash-patterns-title').innerText = t.patternsTitle;
            document.getElementById('dash-report-title').innerText = t.fullReport;
            document.getElementById('dash-medimpact-title').innerText = t.medImpactTitle;
            document.getElementById('dash-triang-title').innerText = t.triangTitle;

            // Marcadores (igual que antes)
            const mUi = document.getElementById('markers-ui');
            mUi.innerHTML = `<h3 class="text-xs font-black text-gray-400 uppercase tracking-widest border-b pb-2">${t.markersTitle}</h3>`;
            (data.markers || []).forEach(m => {
                const div = document.createElement('div');
                div.className = "mt-4";
                div.innerHTML = `
                    <div class="flex justify-between text-[10px] font-black uppercase tracking-tighter mb-2">
                        <span>${m.name}</span> <span class="text-gray-400">${m.score}/10</span>
                    </div>
                    <div class="w-full bg-gray-50 h-1 rounded-full mb-2 overflow-hidden">
                        <div class="progress-bar bg-black h-full rounded-full" style="width: ${m.score*10}%"></div>
                    </div>
                    <p class="text-[10px] text-gray-400 italic">${m.summary}</p>`;
                mUi.appendChild(div);
            });

            // Patrones
            document.getElementById('patterns-ui').innerHTML = (data.patterns || []).map(p => 
                `<span class="bg-gray-50 px-4 py-2 rounded-full text-xs font-bold uppercase tracking-widest border border-gray-100">${p}</span>`
            ).join('');

            // Nueva: Impacto de medicaci√≥n
            document.getElementById('med-impact-ui').innerText = data.medImpact || "Sin datos de medicaci√≥n.";

            // Nueva: Triangulaci√≥n avanzada
            document.getElementById('triang-ui').innerText = data.triangulation || "Triangulaci√≥n completada con √©xito.";

            // Reporte completo
            document.getElementById('report-ui').innerText = data.fullReport || "Informe generado correctamente.";
        }

        // Inicializar
        checkSavedAI();
    </script>
</body>
</html>

/* ThyroidAI - Alejo Malia . 2026 */
/* "The software code is provided for research purposes under the spirit of the CC BY-NC 4.0 license."*/
